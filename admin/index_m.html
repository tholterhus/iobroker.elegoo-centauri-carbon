<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elegoo Centauri Carbon Adapter Settings</title>

```
<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../lib/js/materialize.js"></script>

<script type="text/javascript" src="../../js/translate.js"></script>
<script type="text/javascript" src="../../lib/js/ace/ace.js"></script>
<script type="text/javascript" src="../../lib/js/ace/ext-language_tools.js"></script>
<script type="text/javascript" src="../../js/adapter-settings.js"></script>
```

</head>

<body>

<div class="m adapter-container">

```
<div class="row">
    <div class="col s12 m4 l2">
        <img src="elegoo-centauri-carbon.png" class="logo">
    </div>
</div>

<!-- Connection Settings -->
<div class="row">
    <div class="col s12">
        <ul class="collapsible">
            <li class="active">
                <div class="collapsible-header">
                    <i class="material-icons">wifi</i>
                    <span class="translate">Connection Settings</span>
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        <div class="input-field col s12 m6">
                            <input class="value" id="host" type="text" length="100"/>
                            <label for="host" class="translate">Printer IP Address</label>
                            <span class="helper-text translate">IP address of your Elegoo Centauri Carbon printer</span>
                        <div class="row">
                        <div class="col s12 m6">
                            <p>
                                <label>
                                    <input type="checkbox" class="value" id="enableDebugLogging"/>
                                    <span class="translate">Enable Debug Logging</span>
                                </label>
                            </p>
                            <span class="helper-text translate">Enable detailed logging for troubleshooting</span>
                        </div>
                    </div>
                        <div class="input-field col s12 m6">
                            <input class="value" id="port" type="number" min="1" max="65535"/>
                            <label for="port" class="translate">WebSocket Port</label>
                            <span class="helper-text translate">WebSocket port (default: 3030)</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12 m6">
                            <input class="value" id="cameraPort" type="number" min="1" max="65535"/>
                            <label for="cameraPort" class="translate">Camera Port</label>
                            <span class="helper-text translate">MJPEG camera stream port (default: 8080)</span>
                        </div>
                        <div class="col s12 m6">
                            <p>
                                <label>
                                    <input type="checkbox" class="value" id="enableCamera"/>
                                    <span class="translate">Enable Camera Integration</span>
                                </label>
                            </p>
                            <span class="helper-text translate">Enable camera stream monitoring and controls</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12 m6">
                            <input class="value" id="pollInterval" type="number" min="1000" max="300000"/>
                            <label for="pollInterval" class="translate">Poll Interval (ms)</label>
                            <span class="helper-text translate">How often to request status updates (1000-300000ms)</span>
                        </div>
                        <div class="input-field col s12 m6">
                            <input class="value" id="reconnectInterval" type="number" min="5000" max="300000"/>
                            <label for="reconnectInterval" class="translate">Reconnect Interval (ms)</label>
                            <span class="helper-text translate">How long to wait before reconnecting after connection loss</span>
                        </div>
                    </div>
                </div>
            </li>

            <!-- Camera Settings -->
            <li>
                <div class="collapsible-header">
                    <i class="material-icons">videocam</i>
                    <span class="translate">Camera Settings</span>
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        <div class="col s12">
                            <p class="translate">Configure camera stream monitoring for your printer.</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12 m6">
                            <p>
                                <label>
                                    <input type="checkbox" class="value" id="enableCamera"/>
                                    <span class="translate">Enable Camera Integration</span>
                                </label>
                            </p>
                            <span class="helper-text translate">Enable camera stream monitoring and controls</span>
                        </div>
                        <div class="input-field col s12 m6">
                            <input class="value" id="cameraPort" type="number" min="1" max="65535"/>
                            <label for="cameraPort" class="translate">Camera Port</label>
                            <span class="helper-text translate">MJPEG camera stream port (default: 8080)</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <h6 class="translate">Camera Stream Information</h6>
                            <p class="translate">The camera uses MJPEG streaming protocol. Common stream URLs:</p>
                            <ul class="collection">
                                <li class="collection-item">http://[PRINTER_IP]:8080/video_feed</li>
                                <li class="collection-item">http://[PRINTER_IP]:8080/stream.mjpg</li>
                                <li class="collection-item">http://[PRINTER_IP]/video_feed</li>
                            </ul>
                            <p class="translate">The actual stream URL will be provided by the printer when the camera is enabled.</p>
                        </div>
                    </div>
                </div>
            </li>

            <!-- Test Connection -->
            <li>
                <div class="collapsible-header">
                    <i class="material-icons">settings_ethernet</i>
                    <span class="translate">Connection Test</span>
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        <div class="col s12">
                            <p class="translate">Test the connection to your printer to verify settings.</p>
                            <button id="test-connection" class="btn waves-effect waves-light">
                                <i class="material-icons left">play_arrow</i>
                                <span class="translate">Test Connection</span>
                            </button>
                            <div id="test-result" class="card-panel hide" style="margin-top: 10px;">
                                <span id="test-message"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </li>

            <!-- SDCP Commands Info -->
            <li>
                <div class="collapsible-header">
                    <i class="material-icons">info</i>
                    <span class="translate">SDCP Protocol Info</span>
                </div>
                <div class="collapsible-body">
                    <div class="row">
                        <div class="col s12">
                            <h6 class="translate">Supported Commands</h6>
                            <table class="striped">
                                <thead>
                                    <tr>
                                        <th class="translate">Command</th>
                                        <th class="translate">Function</th>
                                        <th class="translate">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>0</td>
                                        <td class="translate">Request Status</td>
                                        <td class="translate">Get current printer status</td>
                                    </tr>
                                    <tr>
                                        <td>128</td>
                                        <td class="translate">Start Print</td>
                                        <td class="translate">Begin printing a file</td>
                                    </tr>
                                    <tr>
                                        <td>129</td>
                                        <td class="translate">Pause Print</td>
                                        <td class="translate">Pause current print job</td>
                                    </tr>
                                    <tr>
                                        <td>130</td>
                                        <td class="translate">Cancel Print</td>
                                        <td class="translate">Cancel current print job</td>
                                    </tr>
                                    <tr>
                                        <td>131</td>
                                        <td class="translate">Resume Print</td>
                                        <td class="translate">Resume paused print job</td>
                                    </tr>
                                    <tr>
                                        <td>403</td>
                                        <td class="translate">Toggle Light</td>
                                        <td class="translate">Control printer lighting</td>
                                    </tr>
                                    <tr>
                                        <td>386</td>
                                        <td class="translate">Camera Stream</td>
                                        <td class="translate">Enable/disable camera stream</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</div>
```

</div>

<script type="text/javascript">
    // Dictionary for translations
    systemDictionary = {
        "Connection Settings": {
            "en": "Connection Settings",
            "de": "Verbindungseinstellungen",
            "ru": "Настройки подключения",
            "pt": "Configurações de Conexão",
            "nl": "Verbindingsinstellingen",
            "fr": "Paramètres de connexion",
            "it": "Impostazioni di connessione",
            "es": "Configuración de Conexión",
            "pl": "Ustawienia połączenia",
            "zh-cn": "连接设置"
        },
        "Printer IP Address": {
            "en": "Printer IP Address",
            "de": "Drucker IP-Adresse",
            "ru": "IP-адрес принтера",
            "pt": "Endereço IP da Impressora",
            "nl": "Printer IP Adres",
            "fr": "Adresse IP de l'imprimante",
            "it": "Indirizzo IP della stampante",
            "es": "Dirección IP de la Impresora",
            "pl": "Adres IP drukarki",
            "zh-cn": "打印机IP地址"
        },
        "IP address of your Elegoo Centauri Carbon printer": {
            "en": "IP address of your Elegoo Centauri Carbon printer",
            "de": "IP-Adresse Ihres Elegoo Centauri Carbon Druckers",
            "ru": "IP-адрес вашего принтера Elegoo Centauri Carbon",
            "pt": "Endereço IP da sua impressora Elegoo Centauri Carbon",
            "nl": "IP-adres van uw Elegoo Centauri Carbon printer",
            "fr": "Adresse IP de votre imprimante Elegoo Centauri Carbon",
            "it": "Indirizzo IP della tua stampante Elegoo Centauri Carbon",
            "es": "Dirección IP de tu impresora Elegoo Centauri Carbon",
            "pl": "Adres IP drukarki Elegoo Centauri Carbon",
            "zh-cn": "您的 Elegoo Centauri Carbon 打印机的 IP 地址"
        },
        "Poll Interval (ms)": {
            "en": "Poll Interval (ms)",
            "de": "Abfrageintervall (ms)",
            "ru": "Интервал опроса (мс)",
            "pt": "Intervalo de Consulta (ms)",
            "nl": "Poll Interval (ms)",
            "fr": "Intervalle d'interrogation (ms)",
            "it": "Intervallo di polling (ms)",
            "es": "Intervalo de Consulta (ms)",
            "pl": "Interwał odpytywania (ms)",
            "zh-cn": "轮询间隔（毫秒）"
        },
        "Test Connection": {
            "en": "Test Connection",
            "de": "Verbindung testen",
            "ru": "Тест соединения",
            "pt": "Testar Conexão",
            "nl": "Verbinding testen",
            "fr": "Tester la connexion",
            "it": "Testa connessione",
            "es": "Probar Conexión",
            "pl": "Testuj połączenie",
            "zh-cn": "测试连接"
        },
        "Enable Debug Logging": {
            "en": "Enable Debug Logging",
            "de": "Debug-Protokollierung aktivieren",
            "ru": "Включить отладочное логирование",
            "pt": "Habilitar Log de Debug",
            "nl": "Debug logging inschakelen",
            "fr": "Activer la journalisation de débogage",
            "it": "Abilita logging di debug",
            "es": "Habilitar Registro de Debug",
            "pl": "Włącz logowanie debugowania",
            "zh-cn": "启用调试日志"
        }
    };

    // Initialize materialize components
    $(document).ready(function() {
        M.Collapsible.init($('.collapsible'));
        
        // Test connection button
        $('#test-connection').click(function() {
            testConnection();
        });
    });

    // Test connection to printer
    function testConnection() {
        const host = $('#host').val();
        const $button = $('#test-connection');
        const $result = $('#test-result');
        const $message = $('#test-message');
        
        if (!host) {
            showTestResult('error', 'Please enter a printer IP address first.');
            return;
        }
        
        // Disable button and show loading
        $button.addClass('disabled');
        $button.find('span').text('Testing...');
        
        // Simple ping test (note: actual implementation would need server-side support)
        // For demo purposes, we'll simulate a connection test
        setTimeout(() => {
            try {
                // In a real implementation, you would make an AJAX call to test the WebSocket connection
                // For now, we'll just validate the IP format
                const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
                if (ipRegex.test(host)) {
                    showTestResult('success', `Connection test initiated for ${host}. Check the adapter log for results.`);
                } else {
                    showTestResult('error', 'Invalid IP address format.');
                }
            } catch (error) {
                showTestResult('error', `Connection test failed: ${error.message}`);
            }
            
            // Re-enable button
            $button.removeClass('disabled');
            $button.find('span').text('Test Connection');
        }, 2000);
    }

    function showTestResult(type, message) {
        const $result = $('#test-result');
        const $message = $('#test-message');
        
        $result.removeClass('hide red-lighten-4 green-lighten-4');
        
        if (type === 'success') {
            $result.addClass('green-lighten-4');
        } else {
            $result.addClass('red-lighten-4');
        }
        
        $message.text(message);
    }

    // Load settings
    function load(settings, onChange) {
        if (!settings) return;
        
        $('.value').each(function() {
            const $this = $(this);
            const id = $this.attr('id');
            
            if ($this.attr('type') === 'checkbox') {
                $this.prop('checked', settings[id]).trigger('change');
            } else {
                $this.val(settings[id]).trigger('change');
            }
        });
        
        // Update labels for materialize
        M.updateTextFields();
        
        onChange(false);
    }

    // Save settings
    function save(callback) {
        const obj = {};
        $('.value').each(function() {
            const $this = $(this);
            const id = $this.attr('id');
            
            if ($this.attr('type') === 'checkbox') {
                obj[id] = $this.prop('checked');
            } else {
                obj[id] = $this.val();
            }
        });
        
        // Validate required fields
        if (!obj.host) {
            M.toast({html: 'Please enter a printer IP address'});
            return;
        }
        
        // Set defaults
        obj.pollInterval = obj.pollInterval || 10000;
        obj.reconnectInterval = obj.reconnectInterval || 30000;
        
        callback(obj);
    }
</script>

</body>
</html>
